<!DOCTYPE html5>
<html>

<head>
  <script type="text/javascript" src="scripts/jquery1.7.2.js"></script>
  <script type="text/javascript" src="scripts/qunit.js"></script>
  <script type="text/javascript" src="scripts/derive.js"></script>
  <link rel="stylesheet" href="stylesheets/qunit.css" type="text/css" media="screen" />

  <script>
  $(document).ready(function(){
      
            
    module("Derivatives");
      
    test("make range", function() {
      var range = makeRange(0, 10, 10);
      equal(range.length, 10);
      try {
        makeRange(0,10,0);
        ok(0, "didn't throw error");
      } catch(e) {
        ok(1, "threw error on bad range");
      };
    });
    
    test("derive", function() {
      var f1 = derive(function(x) {return x * x;}, .00001);
      ok(Math.abs(f1(9) - 18) < .01, "derive at x = 9");
      ok(Math.abs(f1(50) - 100) < .1, "derive at x = 50"); 
    });
    
    test("evaluate function over range", function() {
      var ys = evalRange(function(x) {return (x + 2) / 3;}, [7, 12, 22, 4, 9]);
      equal(ys.length, 5, "size of result");
      equal(ys[0], 3, "first element");
      equal(ys[3], 2, "fourth element value");
    });
    
    test("evaluate multiple functions over range", function() {
      var fs = [function(x) {return x + 1;}, function(x) {return x * 2;}, function(x) {return 0;}];
      var yseries = evalRangeFuncs(fs, [1,2,12, 9]);
      equal(yseries.length, 3, 'number of y-series');
      yseries.map(
          function(ys) {
              equal(ys.length, 4, "length of each y-series");
          }
      );
      equal(yseries[1][2], 24, JSON.stringify(yseries));
    });
    


    test("validate if all functions and deriviatives defined on domains", function() {
        function makeData(x) {
          return {"function": x[0],
                   xmin:      x[1] + .01, // prevents blowup if undefined on endpoints
                   xmax:      x[2] - .01,
                   xsteps:    150,
                   h:        .001};
        };       

        function sum(x) {
          return x.reduce(function(a, b) { return a + b; }, 0);
        }
        
        function checkFinite(x) {
          if (! isFinite(sum(x["f"]) + sum(x["f''"]) + sum(x["f'''"])) ) {
               throw new Error("bad domain");
          }      
        };               
        
        var funcRngs = [["square",     -10, 10],  // need not be defined on endpoints
                        ["double",     -10, 10],  // function names need to be in the same order as funcs
                        ["cube",       -10, 10],
                        ["exp",        -10, 10],
                        ["fourth",     -10, 10],
                        ["sine",       -10, 10], 
                        ["cosine",     -10, 10],
                        ["tangent",    -1.5, 1.5],
                        ["arcsine",    -1, 1],
                        ["arccosine",  -1, 1],                        
                        ["arctangent", -10, 10]];
        
        var funcKeys  =  Object.keys(funcs);
        var rangeKeys =  funcRngs.map(function(x) {return x[0]; });         
        
           if (funcKeys.length != rangeKeys.length) {
             ok(0, "function ranges not up-to-date");
           }            
             else { 
               for (var i = 0; i < funcKeys.length; i++) {
                  equal(funcKeys[i], rangeKeys[i], 
                    "range " + funcKeys[i] + " is up-to-date");
               }
             }              
                
        var testFuncs = funcRngs.map(makeData);   
        try {testFuncs.map(runDerivatives).map(checkFinite);
              ok(1, "no invalid points for all functions and deriviatives"); 
        } catch (e) {
          ok(0, e);
        } 
    })

    test("calculate derivatives", function() {
      var data = {
        xmin:      "5",
        xmax:      "15",
        xsteps:    "10",
        h:         "0.001",
        'function':  "square"
      };
      var series = runDerivatives(data);

      var ct = 0;
      for(var key in series) {
        if(series.hasOwnProperty(key)) {
          ct++;
        }
        equal(series[key].length, 10, JSON.stringify(series[key]));
      }
      equal(ct, 5, "number of properties in series");
    });
    
  });
    
  </script>
  
</head>
 
 <body>
  <h1 id="qunit-header">QUnit example</h1>
  <h2 id="qunit-banner"></h2>
  <div id="qunit-testrunner-toolbar"></div>
  <h2 id="qunit-userAgent"></h2>
  <ol id="qunit-tests"></ol>
  <div id="qunit-fixture">test markup, will be hidden</div>
  <div id="test_elements" class="myhidden">
   <!-- I put my stuff here -->
  </div>
 </body>

</html>
